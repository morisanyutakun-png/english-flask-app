<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?ver=11">
  <style>
    body {
      font-family:"Hiragino Sans","Noto Sans JP",sans-serif;
      background: linear-gradient(135deg, #f8fafc, #eef2ff);
      margin:0; padding:0; color:#333;
    }
    .container {
      max-width:650px;
      margin:50px auto;
      text-align:center;
      background:white;
      border-radius:20px;
      box-shadow:0 10px 25px rgba(0,0,0,0.1);
      padding:30px 20px;
      position:relative;
    }
    h1.main-title {
      font-size:2rem;
      margin-bottom:10px;
      color:#4f46e5;
      font-weight:700;
    }
    .quiz-card {
      padding:25px 20px;
      border-radius:16px;
      margin:25px auto;
      background:#f3f4f6;
      box-shadow:0 5px 15px rgba(0,0,0,0.05);
      color:#111;
    }
    textarea {
      width:100%; padding:10px; border-radius:10px; border:1px solid #ccc;
      font-size:16px; margin-bottom:10px; box-sizing:border-box;
      color:#111; background:#fff;
    }
    button {
      margin:10px; padding:10px 14px; font-size:1rem; border-radius:8px;
      cursor:pointer; transition:0.2s;
    }
    button.primary-btn { background: linear-gradient(45deg,#4f46e5,#7c3aed); color:white; border:none; }
    button.primary-btn:hover { background: linear-gradient(45deg,#7c3aed,#4f46e5); }
    button.secondary-btn { background:#6b7280; color:white; border:none; }
    button.secondary-btn:hover { background:#4b5563; }
    .nav-links a { text-decoration:none; margin:10px; }
    .prompt { font-size:1.2rem; font-weight:bold; margin-bottom:15px; }

    /* æ¡ç‚¹ä¸­ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
    .overlay {
      position: absolute;
      top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.45);
      display:flex; align-items:center; justify-content:center;
      color:white; font-size:1.6rem; font-weight:bold;
      border-radius:20px;
      z-index:10;
      display:none;
    }
  </style>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2845219606700930"
     crossorigin="anonymous"></script>
</head>
<body>
  <div class="container">
    <h1 class="main-title">ãƒªãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°</h1>
    <p>è‹±èªã®æ–‡ã‚’èª­ã¿ã€æ—¥æœ¬èªã«ç¿»è¨³ã—ã¦ãã ã•ã„ã€‚</p>

    <!-- æ¡ç‚¹ä¸­ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div class="overlay" id="overlay">æ¡ç‚¹ä¸­... â³</div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰ -->
    <div class="quiz-card">
      <p class="prompt">ğŸ“– è‹±æ–‡: {{ prompt or "è‹±æ–‡ãŒã‚ã‚Šã¾ã›ã‚“" }}</p>

      <form id="readingForm" method="POST" action="{{ url_for('submit_reading') }}">
        <textarea name="answer" rows="5" placeholder="ã“ã“ã«æ—¥æœ¬èªè¨³ã‚’å…¥åŠ›..." required></textarea>

        <!-- hiddenãƒ‡ãƒ¼ã‚¿ -->
        <input type="hidden" name="passage_id" value="{{ passage_id or 0 }}">
        <input type="hidden" name="title" value="{{ title or '' }}">
        <input type="hidden" name="correct_answer" value="{{ correct_answer or '' }}">
        <input type="hidden" name="user_id" value="{{ user_id or 0 }}">
        {% if review_mode %}
          <input type="hidden" name="review_mode" value="1">
        {% endif %}

        <br>
        <button type="submit" class="primary-btn" id="submitBtn">é€ä¿¡ã—ã¦æ¡ç‚¹</button>
      </form>
    </div>

    <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="nav-links">
      <a href="{{ url_for('index') }}"><button class="secondary-btn">ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</button></a>
      {% if current_user and current_user.is_authenticated %}
        <a href="{{ url_for('logout') }}"><button class="secondary-btn">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button></a>
      {% endif %}
    </div>
  </div>

  <script>
    // ===== æ¡ç‚¹ä¸­ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤ºã¨äºŒé‡é€ä¿¡é˜²æ­¢ =====
    const form = document.getElementById('readingForm');
    const overlay = document.getElementById('overlay');
    const submitBtn = document.getElementById('submitBtn');

    form.addEventListener('submit', function(e){
      overlay.style.display = 'flex';
      submitBtn.disabled = true; // äºŒé‡é€ä¿¡é˜²æ­¢
    });

    // ===== çµæœãƒšãƒ¼ã‚¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆå¾Œã‚‚è¡¨ç¤ºã‚’æ¶ˆã™ =====
    window.addEventListener('pageshow', function(event) {
      overlay.style.display = 'none';
      submitBtn.disabled = false;
    });
  </script>
</body>
</html>
